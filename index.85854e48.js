var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},i={},s=e.parcelRequired5d1;null==s&&((s=function(e){if(e in t)return t[e].exports;if(e in i){var s=i[e];delete i[e];var r={id:e,exports:{}};return t[e]=r,s.call(r.exports,r,r.exports),r.exports}var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){i[e]=t},e.parcelRequired5d1=s),s.register("3IaX1",(function(e,t){var i,r,n,l;i=e.exports,r="default",n=()=>o,Object.defineProperty(i,r,{get:n,set:l,enumerable:!0,configurable:!0});var a=s("eBuhp");class h{isGameFinish;isGameOver;hCells;vCells;_minesCount;view;matrix;userSelected;time;timerId;flagCounter;constructor(e,t,i,s){this.time=0,this.flagCounter=0,this.timerId=null,this.isGameFinish=!1,this.isGameOver=!1,this.hCells=e,this.vCells=t,this._minesCount=i,this.view=s,this.init()}init(){const{hCells:e,vCells:t,_minesCount:i}=this;this.matrix=h.generateGameMatrix(e,t,i),this.calculate(),this.userSelected=h.generateUserSelect(e,t),this.view.init(a.copyMatrix(this.userSelected),this._minesCount)}startNewGame(){this.isGameFinish=!1,this.isGameOver=!1,this.flagCounter=0,this.resetTimer(),this.generateNewGameField(),this.view.startGame(),this.render()}generateNewGameField(){const{hCells:e,vCells:t,_minesCount:i}=this;this.matrix=h.generateGameMatrix(e,t,i),this.calculate(),this.userSelected=h.generateUserSelect(e,t)}render(){const e=a.copyMatrix(this.userSelected),t=this._minesCount-this.flagCounter;this.view.render(e,t)}selectOne(e,t){if(this.isGameOver||this.isGameFinish)return;null===this.timerId&&0===this.flagCounter&&this.startTimer();const i=this.userSelected[t][e];if(!h.isClosed(i)||h.isMarked(i))return;const s=this.matrix[t][e];if(h.isEmpty(s)){const i=h.getClosestEmptyCells(this.matrix,e,t);this.openEmptyCells(i),this.checkGameFinish()}else h.isMine(s)?this.gameOver():(this.setUserSelect(e,t,this.matrix[t][e]),this.checkGameFinish());this.render()}markCell(e,t){if(this.isGameOver||this.isGameFinish||null===this.timerId)return;const i=this.userSelected[t][e];if(h.isMarked(i))this.reduceFlagCounter(),this.userSelected[t][e]=10;else{if(!h.isClosed(i))return;this.increaseFlagCounter(),this.userSelected[t][e]=12,this.checkGameFinish()}this.render()}startTimer(){this.time=0,this.view.setTime(0),null!==this.timerId&&clearInterval(this.timerId),this.timerId=setInterval((()=>{const e=this.increaseTime();this.view.setTime(e)}),1e3)}checkGameFinish(){this.flagCounter===this._minesCount&&this.isOpenedAllCells()&&this.isFlagsPlacedRight()&&this.finishGame()}finishGame(){this.isGameFinish=!0,this.stopTimer(),this.view.finishGame()}resetTimer(){this.time=0,this.view.setTime(0),null!==this.timerId&&(clearInterval(this.timerId),this.timerId=null)}stopTimer(){clearInterval(this.timerId),this.timerId=null}increaseTime(){return++this.time}increaseFlagCounter(){this.flagCounter++}reduceFlagCounter(){this.flagCounter--}gameOver(){const{userSelected:e}=this;this.stopTimer(),this.matrix.forEach(((t,i)=>{t.forEach(((t,s)=>{h.isMine(t)&&(e[i][s]=11)}))})),this.isGameOver=!0,this.view.gameOver()}calculate(){this.matrix=this.matrix.map(((e,t,i)=>{const s=i[t-1]??[],r=i[t+1]??[];return e.map(((t,i)=>h.isMine(t)?t:h.isMine(s[i-1])+h.isMine(s[i])+h.isMine(s[i+1])+h.isMine(e[i-1])+h.isMine(e[i+1])+h.isMine(r[i-1])+h.isMine(r[i])+h.isMine(r[i+1])))}))}openEmptyCells(e){e.forEach((e=>{const[t,i]=a.parseCoords(e);this.setUserSelect(t,i,0),this.openClosestCells(t,i)}))}openClosestCells(e,t){const{hCells:i,vCells:s}=this;[[e-1,t-1],[e,t-1],[e+1,t-1],[e-1,t],[e+1,t],[e-1,t+1],[e,t+1],[e+1,t+1]].forEach((([e,t])=>{t>=0&&t<s&&e>=0&&e<i&&h.isClosed(this.userSelected[t][e])&&this.setUserSelect(e,t,this.matrix[t][e])}))}setUserSelect(e,t,i){this.userSelected[t][e]=i}isFlagsPlacedRight(){const{userSelected:e,matrix:t}=this,i=[];e.forEach(((e,t)=>{e.forEach(((e,s)=>{h.isMarked(e)&&i.push([t,s])}))}));return-1===i.findIndex((([e,i])=>!h.isMine(t[e][i])))}isOpenedAllCells(){return-1===this.userSelected.findIndex((e=>-1!==e.findIndex((e=>h.isClosed(e)))))}static getClosestEmptyCells(e,t,i){const s=new Map;return function t(i,r){s.set(a.stringifyCoords(i,r),!0);[[i-1,r-1],[i,r-1],[i+1,r-1],[i-1,r],[i+1,r],[i-1,r+1],[i,r+1],[i+1,r+1]].forEach((([i,r])=>{const n=a.stringifyCoords(i,r);e[r]&&h.isEmpty(e[r][i])&&!s.has(n)&&t(i,r)}))}(t,i),Array.from(s.keys())}static isMine(e){return 11===e}static isClosed(e){return 10===e}static isEmpty(e){return 0===e}static isMarked(e){return 12===e}static generateGameMatrix(e,t,i){const s=[];for(let i=0;i<t;i++){const t=new Array(e).fill(0);s.push(t)}return function i(r){if(0===r)return;const n=a.generateRandomNumber(0,e),l=a.generateRandomNumber(0,t);if(0!==s[l][n])return i(r);s[l][n]=11,i(r-1)}(i),s}static generateUserSelect(e,t){const i=[];for(let s=0;s<t;s++){const t=new Array(e).fill(10);i.push(t)}return i}}var o=h})),s("3IaX1");
//# sourceMappingURL=index.85854e48.js.map
